sap.ui.define(["victoria/controller/BaseController"],function(e){"use strict";return e.extend("victoria.controller.MainApp",{idleLogout:function(){var e;var t=this;window.onbeforeunload=function(){t.logOutApp("X")};window.onload=n;window.onmousemove=n;window.onmousedown=n;window.ontouchstart=n;window.onclick=n;window.onkeypress=n;window.addEventListener("scroll",n,true);function o(){sap.m.MessageBox.alert("Page expired, please login again!");window.top.location.href="/"}function n(){clearTimeout(e);e=setTimeout(o,36e5)}},onLogout:function(){this.logOutApp()},onInit:function(){this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("MainApp").attachPatternMatched(this._matchedHandler,this)},_matchedHandler:function(){this.getView().getModel("appView").setProperty("/headerVisible",false)},onSubmit:function(){this.Login()},onLivePassword:function(e){console.log("Test")},Login:function(e){var t={email:this.getView().byId("userid").getValue(),password:this.getView().byId("pwd").getValue()};var o=this;if(!t.email||!t.password){sap.m.MessageBox.error("User/password cannot be empty");return}$.post("/api/Users/login",t).done(function(e,t){o.getOwnerComponent().getModel("local").setProperty("/AuthorizationToken",e.id);o.getView().getModel().setHeaders({Authorization:e.id});o.secureToken=e.id;o.getView().getModel("local").setProperty("/CurrentUser",e.userId);o.getView().getModel().setUseBatch(false);var n=o;var r=false;var i=[];o.ODataHelper.callOData(o.getOwnerComponent().getModel(),"/AppUsers","GET",{},{},o).then(function(t){if(t.results.length!=0){for(var o=0;o<t.results.length;o++){i[t.results[o].TechnicalId]=t.results[o];if(t.results[o].TechnicalId===e.userId){var s=t.results[o].Role;n.getView().getModel("local").setProperty("/Role",t.results[o].Role);n.getView().getModel("local").setProperty("/UserName",t.results[o].UserName);r=true}else{n.getView().getModel("local").setProperty("/Authorization","")}}n.oRouter.navTo("View1")}}).catch(function(e){})}).fail(function(e,t,o){sap.m.MessageBox.error("Login Failed, Please enter correct credentials")})}})});